<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Colorectal Cancer Detection System - User Information</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"/>
    <meta name="csrf-token" content="{{ csrf_token() }}">
     <!-- CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

<!-- JS -->
<script src="{{ url_for('static', filename='script.js') }}"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f3f4f6;
            margin: 0;
            padding: 0;
        }
       
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4rem 2rem;
            background: linear-gradient(135deg, #D4AF37, #F5CBA7); 
            border: 1px solid rgba(173,216,230,0.5);
            backdrop-filter: blur(10px);
            box-shadow: 
                        0 0 45px rgba(173,216,230,0.4);
        }
        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 20px;
        }
        .container h1 {
            font-size: 50px;
            color: black;
        }
        header nav ul {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
        }
        header nav ul li {
            margin-left: 1rem;
        }
        header nav ul li a {
            color: white;
            text-decoration: none;
        }
        header nav ul li a:hover {
            text-decoration: underline;
        }
        .flex {
            display: flex;
        }
        aside {
            width: 15rem;
            background: black;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1rem;
        }
        aside ul {
            list-style: none;
            padding: 1.5rem 2rem 1.5rem;
            margin: 0;
        }
        aside ul li {
            margin-bottom: 1rem;
        }
        aside ul li a {
            color: gold;
            text-decoration: none;
            font: bold;
            font-size: 20px;
            font-weight: 900;
            padding: 10px;
            border-radius: 25px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 2px;
        }
        aside ul li a:hover {
        
    
            border-radius: 20px;
            transform: scale(1.5);
        }
        main {
            flex: 1;
            margin: 2rem;
        }
        .card {
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            width: 100%;
        }
        .card h2, .card h3 {
            margin: 0 0 1rem 0;
            color: #2d3748;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #4a5568;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            margin-left: 5%;
        }
        .form-group input, .form-group select {
            width: 70%;
            padding: 0.5rem;
            border: 1px solid #cbd5e0;
            border-radius: 0.25rem;
            margin-left: 10%;
        }
        .form-group button {
            background-color: #2d3748;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
            margin-left: 5%;
        }
        .form-group button:hover {
            background-color: #4a5568;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .container h1 {
                font-size: 30px;
            }
            aside {
                width: 12rem;
            }
            .card {
                width: 100%;
                padding: 1rem;
            }
            .form-group input, .form-group select {
                width: 100%;
                margin-left: 0;
            }
            .form-group button {
                width: 100%;
                margin-left: 0;
            }
        }

        @media (max-width: 480px) {
            .container h1 {
                font-size: 25px;
            }
            aside {
                width: 100%;
            }
            .form-group input, .form-group select {
                width: 100%;
                margin-left: 0;
            }
            .form-group button {
                width: 100%;
                margin-left: 0;
            }
        }
        

        .modal-content button {
            margin: 10px;
            color: black;
            background-color: gold;
        }
        
        .danger-zone {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #ff6b6b;
        }
        
        .danger-zone h3 {
            color: #ff6b6b;
        }
        
        .danger-zone button {
            background-color: #ff6b6b;
            color: white;
        }
        
        .danger-zone button:hover {
            background-color: #ff5252;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        small {
            display: block;
            font-size: 0.8rem;
            color: #666;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Settings</h1>
        </div>
    </header>

    <div class="flex">
        <aside>
            <ul>
                <li><a href="{{ url_for('website') }}"><i class="fas fa-home"></i> Home</a></li><br>
                <li><a href="{{ url_for('about') }}"><i class="fas fa-info-circle"></i> About</a></li><br>
                <li><a href="{{ url_for('contact') }}"><i class="fas fa-envelope"></i> Contact</a></li><br>
                <li><a href="{{ url_for('settings') }}"><i class="fas fa-cog"></i> Settings</a></li><br>
                <li><a href="{{ url_for('logout') }}" id="logoutLink"><i class="fas fa-sign-out-alt"></i> Log Out</a></li>
            </ul>
        </aside>
        
        <main>
            <div class="card">
                <h2>Settings</h2><br><br>
                <form id="settingsForm">
                    <div class="form-group">
                        <label for="notificationPreferences">Notification Preferences</label>
                        <select id="notificationPreferences" name="notificationPreferences" required>
                            <option value="email">Email</option>
                            <option value="sms">SMS</option>
                            <option value="push">Push Notifications</option>
                        </select>
                    </div>
                 
                    <div class="form-group">
                        <label for="changeEmail">Change Email</label>
                        <input type="email" id="changeEmail" name="changeEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="changePassword">Change Password</label>
                        <input type="password" id="changePassword" name="changePassword" required>
                    </div>
                    <div class="form-group">
                        <label for="changeAccount">Change Account</label>
                        <button type="button" id="changeAccount" name="changeAccount" onclick="showAccountSelection();">Log in to Another Account</button>
                    </div>
                    <div class="form-group">
                        <label for="deleteAccount">Delete Account</label>
                        <button type="button" id="deleteAccount" name="deleteAccount" onclick="deleteAccount()">Delete Account</button>
                    </div>
                    <div id="confirmationModal" class="modal">
                        <div class="modal-content">
                            <h2>Confirm Account Deletion</h2>
                            <p>Are you sure you want to delete your account? This action cannot be undone.</p>
                            <button onclick="confirmDelete()">Yes, delete my account</button>

                            <button onclick="closeModal()">Cancel</button>
                        </div>
                    </div>
                    <div id="accountSelectionModal" class="modal">
                        <div class="modal-content">
                            <h2>Select Account</h2>
                            <p>Please choose an account to log in:</p>
                            <button onclick="selectAccount('account1')">Account 1</button>
                            <button onclick="selectAccount('account2')">Account 2</button>
                            <button onclick="closeAccountSelection()">Cancel</button>
                        </div>
                    </div>
                </div>
            
                    <div class="form-group">
                        <button type="submit">Save Settings</button>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
        <title>Colorectal Cancer Detection System - User Information</title>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"/>
         <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <!-- JS -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
        <style>
            body {
                font-family: 'Roboto', sans-serif;
                background-color: #f3f4f6;
                margin: 0;
                padding: 0;
            }
           
            header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 4rem 2rem;
                background: linear-gradient(135deg, #D4AF37, #F5CBA7); 
                border: 1px solid rgba(173,216,230,0.5);
                backdrop-filter: blur(10px);
                box-shadow: 
                            0 0 45px rgba(173,216,230,0.4);
            }
            header .container {
                display: flex;
                justify-content: space-between;
                align-items: center;
                height: 20px;
            }
            .container h1 {
                font-size: 50px;
                color: black;
            }
            header nav ul {
                display: flex;
                list-style: none;
                padding: 0;
                margin: 0;
            }
            header nav ul li {
                margin-left: 1rem;
            }
            header nav ul li a {
                color: white;
                text-decoration: none;
            }
            header nav ul li a:hover {
                text-decoration: underline;
            }
            .flex {
                display: flex;
            }
            aside {
                width: 15rem;
                background: black;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                padding: 1rem;
            }
            aside ul {
                list-style: none;
                padding: 1.5rem 2rem 1.5rem;
                margin: 0;
            }
            aside ul li {
                margin-bottom: 1rem;
            }
            aside ul li a {
                color: gold;
                text-decoration: none;
                font: bold;
                font-size: 20px;
                font-weight: 900;
                padding: 10px;
                border-radius: 25px;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 2px;
            }
            aside ul li a:hover {
            
        
                border-radius: 20px;
                transform: scale(1.5);
            }
            main {
                flex: 1;
                margin: 2rem;
            }
            .card {
                background-color: #ffffff;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                border-radius: 0.5rem;
                padding: 1.5rem;
                margin-bottom: 2rem;
                width: 100%;
            }
            .card h2, .card h3 {
                margin: 0 0 1rem 0;
                color: #2d3748;
            }
            .form-group {
                margin-bottom: 1rem;
            }
            .form-group label {
                display: block;
                margin-bottom: 0.5rem;
                color: #4a5568;
                font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
                margin-left: 5%;
            }
            .form-group input, .form-group select {
                width: 70%;
                padding: 0.5rem;
                border: 1px solid #cbd5e0;
                border-radius: 0.25rem;
                margin-left: 10%;
            }
            .form-group button {
                background-color: #2d3748;
                color: white;
                padding: 0.75rem 1.5rem;
                border: none;
                border-radius: 0.25rem;
                cursor: pointer;
                margin-left: 5%;
            }
            .form-group button:hover {
                background-color: #4a5568;
            }
    
            /* Responsive Styles */
            @media (max-width: 768px) {
                .container h1 {
                    font-size: 30px;
                }
                aside {
                    width: 12rem;
                }
                .card {
                    width: 100%;
                    padding: 1rem;
                }
                .form-group input, .form-group select {
                    width: 100%;
                    margin-left: 0;
                }
                .form-group button {
                    width: 100%;
                    margin-left: 0;
                }
            }
    
            @media (max-width: 480px) {
                .container h1 {
                    font-size: 25px;
                }
                aside {
                    width: 100%;
                }
                .form-group input, .form-group select {
                    width: 100%;
                    margin-left: 0;
                }
                .form-group button {
                    width: 100%;
                    margin-left: 0;
                }
            }
            .modal {
                display: none;
                position: fixed;
                margin-top: 5%;
                margin-left: 10%;
                right: 0;
                width: 60%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                justify-content: center;
                align-items: center;
            }
    
            .modal-content {
                background-color: white;
                padding: 30px;
                border-radius: 8px;
                width: 300px;
                text-align: center;
            }
    
            .modal-content button {
                margin: 10px;
                color: black;
                background-color: gold;
            }
        </style>
    </head>
    <body>
        <header>
            <div class="container">
                <h1>Settings</h1>
            </div>
        </header>
    
        <div class="flex">
            <aside>
                <ul>
                    <li><a href="{{ url_for('website') }}"><i class="fas fa-home"></i> Home</a></li><br>
                    <li><a href="{{ url_for('about') }}"><i class="fas fa-info-circle"></i> About</a></li><br>
                    <li><a href="{{ url_for('contact') }}"><i class="fas fa-envelope"></i> Contact</a></li><br>
                    <li><a href="{{ url_for('settings') }}"><i class="fas fa-cog"></i> Settings</a></li><br>
                    <li><a href="{{ url_for('logout') }}" id="logoutLink"><i class="fas fa-sign-out-alt"></i> Log Out</a></li>
                </ul>
            </aside>
            
            <main>
                <div class="card">
                    <h2>Account Settings</h2>
                    <form id="settingsForm">
                        <div class="form-group">
                            <label for="currentPassword">Current Password (required for changes)</label>
                            <input type="password" id="currentPassword" name="currentPassword" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="notificationPreferences">Notification Preferences</label>
                            <select id="notificationPreferences" name="notificationPreferences">
                                <option value="email">Email</option>
                                <option value="sms">SMS</option>
                                <option value="none">No Notifications</option>
                            </select>
                        </div>
                     
                        <div class="form-group">
                            <label for="newEmail">New Email</label>
                            <input type="email" id="newEmail" name="newEmail">
                            <small>Leave blank to keep current email</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <input type="password" id="newPassword" name="newPassword">
                            <small>Leave blank to keep current password</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmPassword">Confirm New Password</label>
                            <input type="password" id="confirmPassword" name="confirmPassword">
                        </div>
                        
                        <div class="form-group">
                            <button type="submit" id="saveSettings">Save Changes</button>
                        </div>
                    </form>
                    
                    <div class="danger-zone">
                        <h3>Danger Zone</h3>
                        <button type="button" id="deleteAccountBtn">Delete My Account</button>
                    </div>
                </div>
                           <!-- Delete Account Modal -->
        <div id="deleteAccountModal" class="modal">
            <div class="modal-content">
                <h2>Confirm Account Deletion</h2>
                <p>This will permanently delete your account and all associated data.</p>
                
                <div class="form-group">
                    <label for="deletePassword">Enter your password to confirm:</label>
                    <input type="password" id="deletePassword" required>
                </div>
                
                <div class="modal-actions">
                    <button type="button" id="confirmDeleteBtn">Delete Account</button>
                    <button type="button" id="cancelDeleteBtn">Cancel</button>
                </div>
            </div>
        </div>
                        <div id="accountSelectionModal" class="modal">
                            <div class="modal-content">
                                <h2>Select Account</h2>
                                <p>Please choose an account to log in:</p>
                                <button type="button" onclick="switchToLogin()">
                                    <i class="fas fa-sign-in-alt"></i> Log in to Another Account
                                </button>
                            </div>
                        </div>
                    </div>
                
                        <div class="form-group">
                            <button type="submit">Save Settings</button>
                        </div>
                    </form>
                </div>
            </main>
        </div>
    
        <script>
            // CSRF Token for AJAX requests
            const CSRF_TOKEN = document.querySelector('meta[name="csrf-token"]').content;
            
            // Password strength checker
            function checkPasswordStrength(password) {
                const strongRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})/;
                const mediumRegex = /^(((?=.*[a-z])(?=.*[A-Z]))|((?=.*[a-z])(?=.*[0-9]))|((?=.*[A-Z])(?=.*[0-9])))(?=.{6,})/;
                
                if (strongRegex.test(password)) return 'strong';
                if (mediumRegex.test(password)) return 'medium';
                return 'weak';
            }
            
            // Form validation
            document.getElementById('settingsForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const currentPassword = document.getElementById('currentPassword').value;
                const newEmail = document.getElementById('newEmail').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                // Validate password match if changing password
                if (newPassword && newPassword !== confirmPassword) {
                    alert('New passwords do not match');
                    return;
                }
                
                // Check password strength if changing
                if (newPassword && checkPasswordStrength(newPassword) === 'weak') {
                    alert('Password is too weak. Use at least 8 characters with uppercase, lowercase, numbers and symbols');
                    return;
                }
                
                try {
                    const response = await fetch('/update_settings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRF-Token': CSRF_TOKEN
                        },
                        body: JSON.stringify({
                            current_password: currentPassword,
                            email: newEmail,
                            password: newPassword,
                            notification_preference: document.getElementById('notificationPreferences').value
                        }),
                        credentials: 'include'
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        alert('Settings updated successfully!');
                        if (newEmail) {
                            // If email changed, reload to ensure proper session
                            window.location.reload();
                        }
                    } else {
                        alert('Error: ' + (data.error || 'Failed to update settings'));
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while updating settings');
                }
            });
            
            
    // Delete Account Functionality
    function deleteAccount() {
        document.getElementById('deleteAccountModal').style.display = 'flex';
    }

    function confirmDelete() {
        const password = prompt("Please enter your password to confirm account deletion:");
        if (password) {
            fetch('/delete_account', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': CSRF_TOKEN
                },
                body: JSON.stringify({ password: password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Account deleted successfully');
                    window.location.href = '/';
                } else {
                    alert('Error: ' + (data.error || 'Failed to delete account'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while deleting account');
            });
        }
    }
    async function confirmDelete() {
    const password = prompt("Enter your password to confirm deletion:");
    if (!password) return;

    try {
        const response = await fetch('/delete_account', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content
            },
            body: JSON.stringify({ password }),
            credentials: 'include'
        });

        const data = await response.json();
        
        if (data.success) {
            alert("Account deleted. Redirecting...");
            window.location.href = '/login';  // Redirect to login
        } else {
            alert("Error: " + (data.error || "Deletion failed"));
        }
    } catch (error) {
        alert("Network error. Check console.");
        console.error(error);
    }
}
    // Account Selection Functionality
    function showAccountSelection() {
        document.getElementById('accountSelectionModal').style.display = 'flex';
    }

    function selectAccount(account) {
        alert('Switching to ' + account);
        // Add your actual account switching logic here
        closeAccountSelection();
    }

    function closeModal() {
        document.getElementById('confirmationModal').style.display = 'none';
    }

    function closeAccountSelection() {
        document.getElementById('accountSelectionModal').style.display = 'none';
    }

    // Close modals when clicking outside
    window.onclick = function(event) {
        if (event.target.className === 'modal') {
            event.target.style.display = 'none';
        }
    }
    async function switchToLogin() {
    try {
        // Optional: Clear session first (recommended)
        const response = await fetch('/logout', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-Token': '{{ csrf_token() }}'
            },
            credentials: 'include'
        });

        const data = await response.json();
        
        if (data.success) {
            window.location.href = '/login';  // Redirect to login
        } else {
            alert("Logout failed. Redirecting anyway...");
            window.location.href = '/login';  // Fallback
        }
    } catch (error) {
        console.error("Error:", error);
        window.location.href = '/login';  // Force redirect even if fetch fails
    }
}
        </script>
   
    
</body>
</html>
